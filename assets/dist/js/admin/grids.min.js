"use strict";!function(l,o){var n={admin:pos_host_params,grids:pos_host_admin_grids_params},r={id:"#pos-host-grid-tiles",sortable:{items:".pos-host-grid-tile",handle:".handle",axis:"y",helper:function(i,e){var t=e.children(),d=e.clone();return d.children().each(function(i){l(this).width(t.eq(i).width())}),d},start:function(i,e){l(this).attr("data-current-index",e.item.index()+1)},update:function(i,e){var t=n.grids.grid_id,d=l(this).attr("data-current-index"),a=e.item.index()+1;l(this).removeAttr("data-current-index"),l.ajax({type:"POST",url:n.admin.ajax_url,data:{action:"pos_host_reorder_grid_tile",security:n.grids.grid_tile_nonce,new_position:a,current_position:d,grid_id:t},beforeSend:function(){l("#grid_tiles").sortable("disable")},success:function(i){i.success?r.reloadTiles():o.alert(i.data.error),l("#grid_tiles").sortable("enable")}})}},init:function(){l(this.id).on("click","button.add-tile",this.addTile).on("click","a.delete-tile",this.deleteTile).on("click","button.delete-all-tiles",this.deleteAllTiles),l("#grid_tiles").sortable(this.sortable),l(document.body).on("wc_backbone_modal_loaded",this.backbone.init).on("wc_backbone_modal_response",this.backbone.response)},block:function(){l(this.id).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){l(this.id).unblock()},initTiptip:function(){l("#tiptip_holder").removeAttr("style"),l("#tiptip_arrow").removeAttr("style"),l(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},reloadTiles:function(){var i={grid_id:n.grids.grid_id,action:"pos_host_load_grid_tiles",security:n.grids.grid_tile_nonce};l.ajax({url:n.admin.ajax_url,data:i,type:"POST",success:function(i){l(r.id).find(".inside").empty(),l(r.id).find(".inside").append(i.data.html),r.initTiptip(),r.unblock(),l("#grid_tiles").sortable(r.sortable)}})},addTile:function(){return l(this).WCBackboneModal({template:"pos-host-modal-add-tile"}),l("#pos-host-modal-add-tile").on("change"," select#tile_type",r.toggleTileType),!1},deleteTile:function(i){var e;i.preventDefault(),o.confirm(n.grids.i18n_delete_tile)&&(r.block(),e={action:"pos_host_delete_grid_tile",grid_id:n.grids.grid_id,tile_id:l(this).closest(".pos-host-grid-tile").data("gridTileId"),security:n.grids.grid_tile_nonce},l.ajax({type:"POST",url:n.admin.ajax_url,data:e,success:function(i){i.success?r.reloadTiles():(r.unblock(),o.alert(i.data.error))},dataType:"json"}))},deleteAllTiles:function(i){var e;i.preventDefault(),o.confirm(n.grids.i18n_delete_all_tiles)&&(r.block(),e={action:"pos_host_delete_all_grid_tiles",grid_id:n.grids.grid_id,security:n.grids.grid_tile_nonce},l.ajax({type:"POST",url:n.admin.ajax_url,data:e,success:function(i){i.success?r.reloadTiles():(r.unblock(),o.alert(i.data.error))},dataType:"json"}))},toggleTileType:function(){"product_cat"===l(this).val()?(l("#pos-host-modal-add-tile .product_id_field").hide(),l("#pos-host-modal-add-tile .product_cat_field").show()):(l("#pos-host-modal-add-tile .product_id_field").show(),l("#pos-host-modal-add-tile .product_cat_field").hide())},backbone:{init:function(i,e){"pos-host-modal-add-tile"===e&&l(document.body).trigger("wc-enhanced-select-init")},response:function(i,e,t){"pos-host-modal-add-tile"===e&&r.backbone.add_tile(t)},add_tile:function(i){r.block();var e={action:"pos_host_add_grid_tile",grid_id:n.grids.grid_id,security:n.grids.grid_tile_nonce,data:i};l.ajax({type:"POST",url:n.admin.ajax_url,data:e,success:function(i){i.success?r.reloadTiles():(r.unblock(),o.alert(i.data.error))},dataType:"json"})}}};r.init()}(jQuery,window,document);