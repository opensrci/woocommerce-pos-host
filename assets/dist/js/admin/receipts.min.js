"use strict";

function ownKeys(t, e) {
    var o, i = Object.keys(t);
    return Object.getOwnPropertySymbols && (o = Object.getOwnPropertySymbols(t), e && (o = o.filter(function(e) {
        return Object.getOwnPropertyDescriptor(t, e).enumerable
    })), i.push.apply(i, o)), i
}

function _objectSpread(t) {
    for (var e = 1; e < arguments.length; e++) {
        var o = null != arguments[e] ? arguments[e] : {};
        e % 2 ? ownKeys(Object(o), !0).forEach(function(e) {
            _defineProperty(t, e, o[e])
        }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(o)) : ownKeys(Object(o)).forEach(function(e) {
            Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(o, e))
        })
    }
    return t
}

function _defineProperty(e, t, o) {
    return t in e ? Object.defineProperty(e, t, {
        value: o,
        enumerable: !0,
        configurable: !0,
        writable: !0
    }) : e[t] = o, e
}! function(c, o) {
    var n = {
            admin: pos_host_params,
            receipts: pos_host_admin_receipts_params
        },
        d = {
            id: "#pos-host-receipt-form",
            watchFields: ['[name="name"]', '[name="show_title"]', '[name="title_position"]', '[name="width"]', '[name="logo"]', '[name="logo_position"]', '[name="logo_size"]', '[name="outlet_details_position"]', '[name="show_shop_name"]', '[name="show_outlet_name"]', '[name="show_outlet_address"]', '[name="show_outlet_contact_details"]', '[name="social_details_position"]', '[name="show_social_twitter"]', '[name="show_social_facebook"]', '[name="show_social_instagram"]', '[name="show_social_snapchat"]', '[name="show_wifi_details"]', '[name="show_tax_number"]', '[name="tax_number_label"]', '[name="tax_number_position"]', '[name="show_order_date"]', '[name="order_date_format"]', '[name="order_date_format_custom"]', '[name="order_time_format"]', '[name="order_time_format_custom"]', '[name="show_customer_name"]', '[name="show_customer_email"]', '[name="show_customer_phone"]', '[name="show_customer_shipping_address"]', '[name="show_cashier_name"]', '[name="cashier_name_format"]', '[name="product_details_layout"]', '[name="show_register_name"]', '[name="show_product_image"]', '[name="show_product_sku"]', '[name="show_product_cost"]', '[name="show_product_discount"]', '[name="show_no_items"]', '[name="show_tax_summary"]', '[name="show_order_barcode"]', '[name="barcode_type"]', '[name="header_text"]', '[name="footer_text"]', '[name="text_size"]'],
            cachedDateFormats: {},
            cachedTimeFormats: {},
            logoUploader: null,
            init: function() {
                c(this.id).on("submit", this.submitted).on("change keyup", "input, select, textarea", this.changed).on("change keyup", this.watchFields.join(","), this.updatePreview).on("click", "#customize-control-logo button.upload", this.selectLogo).on("click", "#customize-control-logo button.remove", this.removeLogo).on("click", "#customize-control-logo button.upload, #customize-control-logo button.remove", this.changed).find(this.watchFields.filter(function(e) {
                    return -1 === ['[name="order_date_format"]', '[name="order_date_format_custom"]', '[name="order_time_format"]', '[name="order_time_format_custom"]'].indexOf(e)
                }).join(",")).trigger("change");
                var e = wp.codeEditor.initialize(c("#custom_css"), {
                    codemirror: {
                        lineNumbers: !0,
                        mode: "css",
                        indentUnit: 4,
                        indentWithTabs: !0
                    }
                });
                this.updatePreviewCss(e.codemirror.doc.getValue()), e.codemirror.on("change", function(e) {
                    d.updatePreviewCss(e.doc.getValue()), c("#custom_css").val(e.doc.getValue())
                })
            },
            validate: function(e) {
                var t = {},
                    o = {};
                if (e.forEach(function(e) {
                        t[e.name] = e.value
                    }), void 0 !== t.name && 0 !== t.name.trim().length || (o.name_is_empty = n.receipts.i18n_field_name_empty), void 0 === t.width || 0 === t.width.trim().length ? o.width_is_empty = n.receipts.i18n_field_width_empty : Number(t.width) < 0 && (o.width_is_negative = n.receipts.i18n_field_width_negative), 0 < Object.keys(o).length) {
                    var i = c("#customize-notifications-area"),
                        a = c(".wp-full-overlay-sidebar-content");
                    i.children("ul").html(""), Object.values(o).forEach(function(e) {
                        i.children("ul").append('\n\t\t\t\t\t\t<li class="notice notice-error" data-code="client_side_error" data-type="error">\n\t\t\t\t\t\t\t<div class="notification-message">'.concat(e, "</div>\n\t\t\t\t\t\t</li>"))
                    });
                    var r = i.outerHeight() + 1;
                    return a.css("top", 45 + r + "px"), !1
                }
                return !0
            },
            submitted: function(e) {
                var t;
                e.preventDefault(), c("body").addClass("saving"), d.validate(c(this).serializeArray()) ? (t = {
                    receipt_id: n.receipts.receipt_id,
                    action: "pos_host_update_receipt",
                    data: c(this).serializeArray().reduce(function(e, t) {
                        return _objectSpread(_objectSpread({}, e), {}, _defineProperty({}, t.name, t.value))
                    }),
                    security: n.receipts.update_receipt_nonce
                }, c.ajax({
                    url: n.admin.ajax_url,
                    data: t,
                    type: "POST",
                    success: function(e) {
                        c("body").removeClass("saving"), e.success ? (c(d.id).find('input[type="submit"]').prop("disabled", !0), 0 === n.receipts.receipt_id.length && (o.location.href = n.admin.admin_url + "post.php?post=" + e.data.id + "&action=edit")) : o.alert(e.data.error)
                    }
                })) : c("body").removeClass("saving")
            },
            changed: function() {
                c(d.id).find('input[type="submit"]').prop("disabled", !1)
            },
            updatePreview: function(e) {
                var t, o, i = c(e.target),
                    a = i.attr("name"),
                    r = i.val();
                if ("name" === a && c("#receipt-name").html(r), "show_title" === a && (c(i).is(":checked") ? c("#receipt-title").show() : c("#receipt-title").hide()), "title_position" === a && c("#receipt-title").css("text-align", r), "width" === a && (r = (r = parseInt(r)) && 0 < r && r <= 120 ? "".concat(r, "mm") : "100%", c("#receipt-preview").css("width", r)), "logo" === a && (0 === parseInt(r) || 0 === r.length ? c("#receipt-logo").hide() : c("#receipt-logo").show()), "logo_position" === a && c("#receipt-logo").css("text-align", r), "logo_size" === a) {
                    var s = "auto";
                    switch (r) {
                        case "normal":
                            s = "6cm";
                            break;
                        case "small":
                            s = "2cm";
                            break;
                        case "large":
                            s = "100%"
                    }
                    c("#receipt-logo img").css("width", s)
                }
                if ("outlet_details_position" === a && (c("#receipt-outlet-details").css("text-align", r), c("#receipt-outlet-details-footer").css("text-align", r)), "show_shop_name" === a && (c(i).is(":checked") ? c("#receipt-shop-name").show() : c("#receipt-shop-name").hide()), "show_outlet_name" === a && (c(i).is(":checked") ? c("#receipt-outlet-name").show() : c("#receipt-outlet-name").hide()), "show_outlet_address" === a && (c(i).is(":checked") ? c("#receipt-outlet-address").show() : c("#receipt-outlet-address").hide()), "show_outlet_contact_details" === a && (c(i).is(":checked") ? c("#receipt-outlet-contact-details").show() : c("#receipt-outlet-contact-details").hide()), "social_details_position" === a && (t = c("#receipt-social-details"), "header" === r ? t.insertAfter("#receipt-wifi-details") : "footer" === r && t.appendTo("#receipt-outlet-details-footer")), "show_social_twitter" === a && (c(i).is(":checked") ? c("#receipt-social-twitter").show() : c("#receipt-social-twitter").hide()), "show_social_facebook" === a && (c(i).is(":checked") ? c("#receipt-social-facebook").show() : c("#receipt-social-facebook").hide()), "show_social_instagram" === a && (c(i).is(":checked") ? c("#receipt-social-instagram").show() : c("#receipt-social-instagram").hide()), "show_social_snapchat" === a && (c(i).is(":checked") ? c("#receipt-social-snapchat").show() : c("#receipt-social-snapchat").hide()), "show_wifi_details" === a && (c(i).is(":checked") ? c("#receipt-wifi-details").show() : c("#receipt-wifi-details").hide()), "show_tax_number" === a && (c(i).is(":checked") ? c("#receipt-tax-number").show() : c("#receipt-tax-number").hide()), "tax_number_label" === a && (0 < r.length ? c("#receipt-tax-number-label").html(r + ":") : c("#receipt-tax-number-label").html("")), "tax_number_position" === a && c("#receipt-tax-number").css("text-align", r), "show_order_date" === a && (c(i).is(":checked") ? c("#receipt-order-date").show() : c("#receipt-order-date").hide()), "order_date_format" === a || "order_date_format_custom" === a) {
                    if (r = "" === c('[name="order_date_format"]:checked').val() ? c('[name="order_date_format_custom"]').val() : r, void 0 !== d.cachedDateFormats[r]) return void c("#receipt-order-date td .date").html(d.cachedDateFormats[r]);
                    c.ajax({
                        url: n.admin.ajax_url,
                        data: {
                            action: "pos_host_date_i18n",
                            security: n.receipts.date_i18n_nonce,
                            data: {
                                format: r,
                                date: n.receipts.time
                            }
                        },
                        type: "POST",
                        success: function(e) {
                            e.success && (c("#receipt-order-date td .date").html(e.data.date), d.cachedDateFormats[r] = e.data.date)
                        }
                    })
                }
                if ("order_time_format" === a || "order_time_format_custom" === a) {
                    if (r = "" === c('[name="order_time_format"]:checked').val() ? c('[name="order_time_format_custom"]').val() : r, void 0 !== d.cachedTimeFormats[r]) return void c("#receipt-order-date td .time").html(d.cachedTimeFormats[r]);
                    c.ajax({
                        url: n.admin.ajax_url,
                        data: {
                            action: "pos_host_date_i18n",
                            security: n.receipts.date_i18n_nonce,
                            data: {
                                format: r,
                                date: n.receipts.date
                            }
                        },
                        type: "POST",
                        success: function(e) {
                            e.success && (c("#receipt-order-date td .time").html(e.data.date), d.cachedTimeFormats[r] = e.data.date)
                        }
                    })
                }
                "show_customer_name" === a && (c(i).is(":checked") ? c("#receipt-customer-name").show() : c("#receipt-customer-name").hide()), "show_customer_email" === a && (c(i).is(":checked") ? c("#receipt-customer-email").show() : c("#receipt-customer-email").hide()), "show_customer_phone" === a && (c(i).is(":checked") ? c("#receipt-customer-phone").show() : c("#receipt-customer-phone").hide()), "show_customer_shipping_address" === a && (c(i).is(":checked") ? c("#receipt-customer-shipping-address").show() : c("#receipt-customer-shipping-address").hide()), "show_cashier_name" === a && (c(i).is(":checked") ? c("#receipt-cashier-name").show() : c("#receipt-cashier-name").hide()), "cashier_name_format" === a && c("#receipt-cashier-name .cashier").html(c("#receipt-cashier-name").data(r)), "product_details_layout" === a && ("single" === r ? (c(".receipt-product-details-layout-single").css("display", "table-header-group"), c(".receipt-product-details-layout-multiple").css("display", "none")) : (c(".receipt-product-details-layout-multiple").css("display", "table-header-group"), c(".receipt-product-details-layout-single").css("display", "none"))), "show_register_name" === a && (c(i).is(":checked") ? c("#receipt-register-name").show() : c("#receipt-register-name").hide()), "show_product_image" === a && (c(i).is(":checked") ? (c("thead th.image").show(), c(".receipt-product-image").show()) : (c("thead th.image").hide(), c(".receipt-product-image").hide())), "show_product_sku" === a && (c(i).is(":checked") ? c(".receipt-product-sku").show() : c(".receipt-product-sku").hide()), "show_product_cost" === a && (c(i).is(":checked") ? (c("thead th.cost").show(), c(".receipt-product-cost").show()) : (c("thead th.cost").hide(), c(".receipt-product-cost").hide())), "show_product_discount" === a && (c(i).is(":checked") ? (c("#receipt-preview .show-if-discount-enabled").show(), c("#receipt-preview .line-through-if-discount-enabled").css("text-decoration", "line-through")) : (c("#receipt-preview .show-if-discount-enabled").hide(), c("#receipt-preview .line-through-if-discount-enabled").css("text-decoration", "none"))), "show_no_items" === a && (c(i).is(":checked") ? c("#receipt-no-items").show() : c("#receipt-no-items").hide()), "show_tax_summary" === a && (c(i).is(":checked") ? c("#receipt-tax-summary").show() : c("#receipt-tax-summary").hide()), "show_order_barcode" === a && (c(i).is(":checked") ? c("#receipt-order-barcode").show() : c("#receipt-order-barcode").hide()), "barcode_type" === a && (o = document.createElement("canvas"), bwipjs.toCanvas(o, {
                    bcid: r,
                    text: "WC1234AE",
                    scale: 2,
                    includetext: !0,
                    textxalign: "center"
                }), c("#receipt-order-barcode img").attr("src", o.toDataURL("image/png"))), "header_text" === a && c("#receipt-header-text").html(r), "footer_text" === a && c("#receipt-footer-text").html(r), "text_size" === a && c("#receipt-preview").removeClass("text-tiny text-small text-normal text-large").addClass("text-" + r)
            },
            selectLogo: function() {
                if (!d.logoUploader) return d.logoUploader = wp.media.frames.logoUploader = wp.media({
                    title: "Select a Receipt Logo ",
                    button: {
                        text: "Set Receipt Logo"
                    },
                    multiple: !1,
                    library: {
                        type: "image/png,image/jpeg"
                    }
                }), d.logoUploader.on("select", function() {
                    var e = d.logoUploader.state().get("selection").first().toJSON();
                    c("#logo").val(e.id).trigger("change"), c("#customize-control-logo").addClass("selected"), c("#customize-control-logo .attachment-thumb").attr("src", e.url), c("#receipt-preview #receipt-logo img").attr("src", e.url)
                }), d.logoUploader.open(), !1;
                d.logoUploader.open()
            },
            removeLogo: function() {
                return c("#logo").val("").trigger("change"), c("#customize-control-logo").removeClass("selected"), c("#customize-control-logo .attachment-thumb").attr("src", ""), c("#receipt-preview #receipt-logo img").attr("src", ""), !1
            },
            updatePreviewCss: function(e) {
                c("#receipt-custom-css").replaceWith('<style type="text/less" id="receipt-custom-css">#receipt-preview {'.concat(e, "}</style>")), o.less && o.less.refresh(!0)
            }
        };
    d.init(), c(d.id).find("#save").prop("disabled", !1), c(".customize-pane-parent").on("click", ".accordion-section-title", function(e) {
        e.preventDefault();
        var t = c(this).parent().attr("aria-owns"),
            o = c("#" + t);
        c(".wp-full-overlay-sidebar-content").addClass("section-open"), o.addClass("open")
    }), c(".customize-pane-child").on("click", ".customize-section-back", function(e) {
        c(this).parents(".customize-pane-child").removeClass("open"), c(".wp-full-overlay-sidebar-content").removeClass("section-open")
    })
}(jQuery, window, document);